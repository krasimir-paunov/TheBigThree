@model IEnumerable<CollectionAllViewModel>

@{
    ViewBag.Title = "COMMUNITY HUB";
}

<div class="hub-background overflow-hidden" style="width: 100vw; margin-left: calc(-50vw + 50%);">
    <div class="container">

        <div class="row align-items-center mb-5 px-3">
            <div class="col-md-3 d-none d-md-block"></div>

            <div class="col-md-6 text-center">
                <h2 class="hub-title mb-0">@ViewBag.Title</h2>
                <div class="badge bg-info text-dark shadow-sm">Explore the Big Three</div>
            </div>

            <div class="col-md-3 text-center text-md-end mt-3 mt-md-0">
                @if (User.Identity?.IsAuthenticated == true && ViewBag.UserHasCollection == false)
                {
                    <a asp-controller="Collection" asp-action="Add" class="btn btn-warning px-4 rounded-pill shadow fw-bold">
                        <i class="bi bi-plus"></i> Create Your Own
                    </a>
                }
                else if (User.Identity?.IsAuthenticated == false)
                {
                    <a asp-area="Identity" asp-page="/Account/Login" class="btn btn-outline-info px-4 rounded-pill fw-bold">
                        <i class="bi bi-box-arrow-in-right"></i> Login to Create
                    </a>
                }
            </div>
        </div>

        <div class="row justify-content-center">
            @if (!Model.Any())
            {
                <div class="col-12 text-center py-5">
                    <h3 class="text-light opacity-50">No collections found. Be the first to create one!</h3>
                </div>
            }

            <div class="container mb-4">
                <div class="d-flex align-items-center gap-2">
                    <span class="text-white-50 small fw-bold text-uppercase me-2" style="letter-spacing: 1.5px; font-size: 0.7rem;">Sort by:</span>

                    <a asp-action="All" asp-route-sorting="Newest"
                       class="btn btn-sm @(ViewBag.CurrentSort == "Newest" || string.IsNullOrEmpty(ViewBag.CurrentSort) ? "btn-info" : "btn-outline-info") rounded-pill px-3 py-1"
                       style="font-size: 0.7rem; font-weight: 700;">
                        <i class="bi bi-clock-history me-1"></i> NEWEST
                    </a>

                    <a asp-action="All" asp-route-sorting="Stars"
                       class="btn btn-sm @(ViewBag.CurrentSort == "Stars" ? "btn-info" : "btn-outline-info") rounded-pill px-3 py-1"
                       style="font-size: 0.7rem; font-weight: 700;">
                        <i class="bi bi-star-fill me-1"></i> STARS
                    </a>
                </div>
                <hr class="border-secondary opacity-25 mt-3" />
            </div>

            @foreach (var collection in Model)
            {
                <div class="col-lg-4 col-md-6 d-flex justify-content-center mb-5">
                    <div class="card collection-card shadow-lg" style="width: 23rem;">
                        <div class="card-body p-4">
                            <h5 class="card-title-gold fw-bold text-center mb-3">@collection.Title</h5>

                            <div class="d-flex justify-content-center align-items-center mb-3">
                                <span class="text-light opacity-75 small me-2">Curated by</span>
                                <span class="fw-bold text-white">@collection.Publisher</span>
                                <span class="badge rounded-pill bg-info text-dark ms-2 shadow-sm" style="font-size: 0.65rem;">
                                    @collection.PublisherRank
                                </span>
                            </div>

                            <div class="text-center mb-4">
                                <span class="h4 text-warning fw-bold">⭐ @collection.TotalStars</span>
                                <div class="text-muted small text-uppercase" style="font-size: 0.7rem; letter-spacing: 1px;">Total Stars</div>
                            </div>

                            <div class="d-flex justify-content-between mb-4">
                                @foreach (var imgUrl in collection.GameImages)
                                {
                                    <div class="game-thumb-container rounded p-1" style="width: 30%; height: 75px;">
                                        <img src="@imgUrl" class="img-fluid h-100 w-100" style="object-fit: contain;" alt="Game Image">
                                    </div>
                                }
                            </div>

                            <div class="d-grid mt-2">
                                <a asp-controller="Collection" asp-action="Details" asp-route-id="@collection.Id"
                                   class="btn btn-outline-info btn-lg rounded-pill fw-bold py-2 shadow-sm">
                                    <i class="bi bi-eye-fill"></i> View Collection
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>